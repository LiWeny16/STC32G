C251 COMPILER V5.60.0,  road                                                               06/04/23  00:08:05  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE road
OBJECT MODULE PLACED IN .\Out\road.obj
COMPILER INVOKED BY: C:\Learning\Keil_v5\body\C251\BIN\C251.EXE User\User_c\road.c XSMALL INTR2 BROWSE INCDIR(.\Lib\libr
                    -aries;.\Lib\seekfree_libraries;.\Lib\seekfree_peripheral;.\User\User_h) DEBUG PRINT(.\Listings\road.lst) TABS(2) OBJECT(
                    -.\Out\road.obj) 

stmt  level    source

    1          // 该文件用于对道路情况进行判断，并将相应标志位赋值
    2          
    3          #include "road.h"
    4          Road road_judge(TIMER *timer,FLAG *road_flag,DG_State *dg_state ,Err_Steering *err_steering)
    5          {
    6   1        int32 L_Sum;
    7   1        L_Sum = dg_state->L_zh_real + dg_state->L_yh_real + dg_state->L_zx_real + dg_state->L_yx_real;
    8   1        tempVar = (float)L_Sum;
    9   1        P41 = 1;
   10   1        P52= 1;
   11   1        //********************************************************
   12   1        if(timer->time1_0>0){
   13   2          timer->time1_0--;
   14   2          if(timer->time1_0>0 && timer->time1_0<=114){ //延时25
   15   3            return  Ring_In;
   16   3          }
   17   2          if(timer->time1_0<=0){
   18   3            timer->time1_0 =0;
   19   3          }
   20   2          
   21   2        }
   22   1        if(timer->time0_0>=20){ //到时间了，做事情 中断20ms一次 所以一次20ms 1s 50次
   23   2          if(
   24   2              road_flag->Cross_Flag_Last==1 && 
   25   2              L_Sum >= 10500 &&
   26   2              isNear(&dg_state, 2661, 1965, 3688, 3634,15000) == 0
   27   2          ){
*** WARNING C98 IN LINE 24 OF User\User_c\road.c: parameter 1: pointer to different objects
*** WARNING C91 IN LINE 24 OF User\User_c\road.c: '&': pointer to different objects
   28   3            road_flag->Cross_Flag++;
   29   3            road_flag->Cross_Flag_Last=0;
   30   3          }
   31   2          //清除计时器
   32   2          timer->time0_0=0;
   33   2          timer->time0_1=0;
   34   2        } 
   35   1        //*********************************************************
   36   1        
   37   1        if (400 < L_Sum && L_Sum < 5000) // 直走
   38   1        {
   39   2          return Straight;
   40   2        }
   41   1        else if ( // 左转
   42   1          5000 <= L_Sum &&
   43   1          L_Sum < 9500 &&
   44   1          err_steering->Err >=0.5)
   45   1        {
   46   2          return Curve_Left;
   47   2        }
   48   1        else if ( // 右转
   49   1          5000 <= L_Sum &&
   50   1          L_Sum < 9500 &&
   51   1          err_steering->Err <= -0.5)
   52   1        {
   53   2          return Curve_Right;
   54   2        }
   55   1        // else if ( // 在圆环内
C251 COMPILER V5.60.0,  road                                                               06/04/23  00:08:05  PAGE 2   

   56   1        //  7000 <= L_Sum &&
   57   1        //  err_steering->Err < 0)
   58   1        // {
   59   1        //  return Big_Ring;
   60   1        // }
   61   1        else if ( //进环点
   62   1          L_Sum >= 10000 &&
   63   1          L_Sum <= 11200 &&
   64   1          dg_state->L_yx_real <=500 &&
   65   1          isNear(&dg_state,3699,3661,3577,35,12000)==1
   66   1          )
*** WARNING C98 IN LINE 62 OF User\User_c\road.c: parameter 1: pointer to different objects
*** WARNING C91 IN LINE 62 OF User\User_c\road.c: '&': pointer to different objects
   67   1        {
   68   2            P41=0;
   69   2          timer->time1_0=120; //*20ms
   70   2          if(road_flag->Ring_Out_Flag ==0){//不同时为1，代表没走过大圆环
   71   3            road_flag->Ring_In_Flag=1;
   72   3              return Ring_In;
   73   3          }else{
   74   3            // 代表走过了，略过即可
   75   3            return Straight;
   76   3          }
   77   2        }
   78   1        else if ( //出环点
   79   1          L_Sum >= 11500 &&
   80   1          dg_state->L_yh_real <=1650 &&
   81   1          isNear(&dg_state,3681,1512,3701,3564,12000)==1
   82   1          )
*** WARNING C98 IN LINE 79 OF User\User_c\road.c: parameter 1: pointer to different objects
*** WARNING C91 IN LINE 79 OF User\User_c\road.c: '&': pointer to different objects
   83   1        {
   84   2          if(road_flag->Ring_In_Flag ==1){
   85   3            road_flag->Ring_Out_Flag =1;//碰到且已经入圆环，就打标记
   86   3            return Ring_Out;
   87   3          }else{
   88   3            return Straight;
   89   3          }
   90   2        }
   91   1        else if ( // 十字路口
   92   1          L_Sum >= 11000 &&
   93   1          isNear(&dg_state, 2661, 1965, 3688, 3634,13000) == 1)
*** WARNING C98 IN LINE 92 OF User\User_c\road.c: parameter 1: pointer to different objects
*** WARNING C91 IN LINE 92 OF User\User_c\road.c: '&': pointer to different objects
   94   1        {
   95   2        
   96   2          road_flag->Ring_In_Flag = 0;
   97   2          road_flag->Ring_Out_Flag = 0;
   98   2          road_flag->Cross_Flag_Last = 1;
   99   2          //定时器*******************
  100   2          timer->time0_0++;
  101   2          if(timer->time0_0>=500){
  102   3            timer->time0_0=0;
  103   3            timer->time0_1++;
  104   3            timer->time0_1=timer->time0_1>=50?0:timer->time0_1;//防止溢出
  105   3          }
  106   2        
  107   2          //定时器*******************
  108   2          return Force_Straight;
  109   2        }
  110   1        else if (
  111   1             (dg_state->L_zh_real <= 6) && (dg_state->L_zh_real >=0)  || //完全丢线 逻辑与优先级高
  112   1             (dg_state->L_yh_real <= 6) && (dg_state->L_yh_real >=0)  ||
  113   1             (dg_state->L_zx_real <= 6) && (dg_state->L_zx_real >=0)  ||
  114   1             (dg_state->L_yx_real <= 6) && (dg_state->L_yx_real >=0) )
  115   1        {
C251 COMPILER V5.60.0,  road                                                               06/04/23  00:08:05  PAGE 3   

  116   2        //  tempVar1=2333.0;
  117   2          return Stop;
  118   2        }
  119   1      
  120   1        else
  121   1        {
  122   2        //  tempVar1=3222;
  123   2          return Straight;
  124   2        }
  125   1      }
  126          int16 isNear(DG_State *dg_state,int16 zh,int16 yh,int16 zx,int16 yx,int16 bear)
  127          {
  128   1        if((float)(((int16)dg_state->L_zh_real - zh) * ((int16)dg_state->L_zh_real - zh) +
  129   1             ((int16)dg_state->L_yh_real - yh) * ((int16)dg_state->L_yh_real - yh) +
  130   1             ((int16)dg_state->L_zx_real - zx) * ((int16)dg_state->L_zx_real - zx) +
  131   1             ((int16)dg_state->L_yx_real - yx) * ((int16)dg_state->L_yx_real - yx)) /10 <=bear)
  132   1        {
  133   2          return 1;
  134   2        }
  135   1        else
  136   1        {
  137   2          return 0;
  138   2        }
  139   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       913     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------         22
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  8 WARNING(S),  0 ERROR(S)
